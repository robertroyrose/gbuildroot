From 32d04bb7039acb714c0198769f27fc6813b0e230 Mon Sep 17 00:00:00 2001
From: Robert Rose <robertroyrose@gmail.com>
Date: Sun, 25 Nov 2018 09:47:09 -0800
Subject: [PATCH 3/4] boringssl: new package

Signed-off-by: Robert Rose <robertroyrose@gmail.com>
---
 package/Config.in              |  1 +
 package/boringssl/Config.in    | 19 ++++++++++++++++++
 package/boringssl/boringssl.mk | 35 ++++++++++++++++++++++++++++++++++
 3 files changed, 55 insertions(+)
 create mode 100644 package/boringssl/Config.in
 create mode 100644 package/boringssl/boringssl.mk

diff --git a/package/Config.in b/package/Config.in
index 2d0cc51797..78c00e4e17 100644
--- a/package/Config.in
+++ b/package/Config.in
@@ -1155,6 +1155,7 @@ endmenu
 
 menu "Crypto"
 	source "package/beecrypt/Config.in"
+	source "package/boringssl/Config.in"
 	source "package/botan/Config.in"
 	source "package/ca-certificates/Config.in"
 	source "package/cryptodev/Config.in"
diff --git a/package/boringssl/Config.in b/package/boringssl/Config.in
new file mode 100644
index 0000000000..91b36cd503
--- /dev/null
+++ b/package/boringssl/Config.in
@@ -0,0 +1,19 @@
+config BR2_PACKAGE_BORINGSSL
+	bool "boringssl"
+	depends on BR2_PACKAGE_HOST_GO_ARCH_SUPPORTS
+	depends on BR2_USE_WCHAR
+	help
+	  BoringSSL is a fork of OpenSSL that is designed to meet Google's needs.
+
+	  Although BoringSSL is an open source project, it is not intended for
+	  general use, as OpenSSL is. We don't recommend that third parties depend
+	  upon it. Doing so is likely to be frustrating because there are no
+	  guarantees of API or ABI stability.
+
+	  https://boringssl.googlesource.com
+
+comment "boringssl needs a toolchain w/ wchar, threads"
+	depends on BR2_PACKAGE_HOST_GO_ARCH_SUPPORTS && \
+		BR2_PACKAGE_HOST_GO_CGO_LINKING_SUPPORTS
+	depends on !BR2_TOOLCHAIN_HAS_THREADS
+	depends on !BR2_USE_WCHAR
diff --git a/package/boringssl/boringssl.mk b/package/boringssl/boringssl.mk
new file mode 100644
index 0000000000..16e9977467
--- /dev/null
+++ b/package/boringssl/boringssl.mk
@@ -0,0 +1,35 @@
+################################################################################
+#
+# boringssl
+#
+################################################################################
+
+#BORINGSSL_VERSION = 6f5f49f33d88f446f7f690bf991e835d5137af6c
+BORINGSSL_VERSION = fips-20180730
+BORINGSSL_SITE = https://boringssl.googlesource.com/boringssl
+BORINGSSL_SITE_METHOD = git
+BORINGSSL_LICENSE = OpenSSL or SSLeay
+BORINGSSL_LICENSE_FILES = LICENSE
+BORINGSSL_INSTALL_STAGING = YES
+
+BORINGSSL_DEPENDENCIES = host-go
+
+# install to extra boringssl directory to not interfere with original openssl
+define BORINGSSL_INSTALL_STAGING_CMDS
+	mkdir -p $(STAGING_DIR)/usr/include/boringssl
+	cp -r $(@D)/include/openssl  $(STAGING_DIR)/usr/include/boringssl
+	mkdir -p $(STAGING_DIR)/usr/lib/boringssl
+	cp $(@D)/crypto/libcrypto.so $(STAGING_DIR)/usr/lib/boringssl
+	cp $(@D)/decrepit/libdecrepit.so $(STAGING_DIR)/usr/lib/boringssl
+	cp $(@D)/ssl/libssl.so $(STAGING_DIR)/usr/lib/boringssl
+endef
+
+# install to extra boringssl directory to not interfere with original openssl
+define BORINGSSL_INSTALL_TARGET_CMDS
+	mkdir -p $(TARGET_DIR)/usr/lib/boringssl
+	cp $(@D)/crypto/libcrypto.so $(TARGET_DIR)/usr/lib/boringssl
+	cp $(@D)/decrepit/libdecrepit.so $(TARGET_DIR)/usr/lib/boringssl
+	cp $(@D)/ssl/libssl.so $(TARGET_DIR)/usr/lib/boringssl
+endef
+
+$(eval $(cmake-package))
-- 
2.19.1

